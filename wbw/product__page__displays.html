

<!-- DESKTOP -->


<!-- Desktop Placholder Title  -->
<div class="custom-result-count">
</div>

<!-- Desktop Products Div Scripts (No Pagination) -->
<script>
  jQuery(document).ready(function($) {
    if ($(window).width() > 980) {

      function updateCount() {
        setTimeout(function() {
            // Count only in the FIRST products container (desktop)
            var count = $('ul.products:first li.product:visible').length;
            
            // Get selected filter names
            var selectedFilters = [];
            $('.desktop-filter-area .wpfCheckbox input[type="checkbox"]:checked').each(function() {
                // Go up one level and find next .wpfDisplay
                var filterLabel = $(this).closest('.wpfCheckbox').parent().find('.wpfDisplay .wpfFilterTaxNameWrapper').text().trim();
                
                if (filterLabel) {
                    selectedFilters.push(filterLabel);
                }
            });
            
            // Build the HTML
            var html = '<p>Showing ' + count + ' Results</p>';
            
            if (selectedFilters.length > 0) {
              // Map each filter name to a new array where it's wrapped in <span> tags
              var wrappedFilters = selectedFilters.map(function(filterName) {
                  return '<span>' + filterName + '</span>';
              });

              // Join the wrapped filters with a simple separator (like a comma and space)
              html += '<p class="custom-result-count-active-filter"><strong>Filters Applied:</strong> ' + wrappedFilters.join(' ') + '</p>';
            }
            
            $('.custom-result-count').html(html);
            console.log('Desktop count:', count);
        }, 500);
      }
      
      // ADD THESE LINES BACK:
      $(document).on('berocket_ajax_products_loaded berocket_ajax_filtering_end', updateCount);
      $(document).ajaxComplete(updateCount);
      updateCount(); // Call on initial page load

      // Filter and Clear Buttons styles
      function updateFilterButtonStates() {
        var hasActiveFilters = $('.wpfCheckbox input[type="checkbox"]:checked').length > 0;
        
        var $filterButton = $('.wpfFilterButton, button[type="submit"]').filter(function() {
            return $(this).text().toLowerCase().includes('filter');
        });
        
        var $clearButton = $('.wpfClearButton');
        var $resultCount = $('.custom-result-count');
        
        if (hasActiveFilters) {
            // Filters are active
            $filterButton.addClass('has-active-filters').removeClass('no-active-filters');
            $clearButton.addClass('has-active-filters').removeClass('no-active-filters');
            $resultCount.addClass('has-active-filters').removeClass('no-active-filters');
        } else {
            // No filters active
            $filterButton.addClass('no-active-filters').removeClass('has-active-filters');
            $clearButton.addClass('no-active-filters').removeClass('has-active-filters');
            $resultCount.addClass('no-active-filters').removeClass('has-active-filters');
        }
        
        console.log('Filter buttons updated. Active filters:', hasActiveFilters);
      }

      // Update when Filter or Clear buttons are clicked
      $(document).on('click', '.wpfFilterButton, .wpfClearButton, button[type="submit"]', function() {
          setTimeout(updateFilterButtonStates, 500);
      });

      // Update after AJAX completes
      $(document).on('berocket_ajax_products_loaded berocket_ajax_filtering_end', function() {
          setTimeout(updateFilterButtonStates, 300);
      });

      // Update on AJAX completion
      $(document).ajaxComplete(function() {
          setTimeout(updateFilterButtonStates, 500);
      });

      // Initial state
      updateFilterButtonStates();

    }
  });
</script>

<!-- Add Class to code block holding the filter shortcode - on the left -->
desktop-filter-area

<!-- Shortcode for Products Display on Desktop -->
[products category="specialty-colors" limit="-1" per_page="-1" columns="5"]


<!-- /////////////// STILL WORKING ON THIS /////////////// -->
<!-- Desktop Products Div Scripts (Pagination) -->
<script>
  jQuery(document).ready(function($) {
    if ($(window).width() > 980) {

      // Function to apply/remove active classes based on the filter status
      function applyButtonClasses(hasActiveFilters) {
          // Use the most specific selector possible to win the CSS race
          var $clearButton = $('.wpfFilterButtons .wpfClearButton');
          var $filterButton = $('.wpfFilterButtons .wpfFilterButton');
          var $resultCount = $('.custom-result-count');
          var $sliderRange = $('.wpfPriceFilterRange');

          if (hasActiveFilters) {
              // ADD the active class and immediately remove the inactive one
              $clearButton.addClass('has-active-filters').removeClass('no-active-filters');
              $filterButton.addClass('has-active-filters').removeClass('no-active-filters');
              $resultCount.addClass('has-active-filters').removeClass('no-active-filters');
              $sliderRange.addClass('has-active-filters').removeClass('no-active-filters');
              console.log('(Desktop) Class Applied Has Active Filters'); // Use for testing confirmation
          } else {
              // REMOVE the active class and immediately add the inactive one
              $clearButton.removeClass('has-active-filters').addClass('no-active-filters');
              $filterButton.removeClass('has-active-filters').addClass('no-active-filters');
              $resultCount.removeClass('has-active-filters').addClass('no-active-filters');
              $sliderRange.removeClass('has-active-filters').addClass('no-active-filters');
              console.log('(Desktop) Class Applied No Active Filters'); // Use for testing confirmation
          }
      }

      // --- 1. FUNCTION TO UPDATE COUNT AND ACTIVE FILTERS ---
      function updateCount() {
          // Use a short delay to ensure AJAX is complete and values are updated
          setTimeout(function() {
              var wooCommerceCount = $('.woocommerce-result-count').first().text().trim();
              
              if (!wooCommerceCount) {
                  var count = $('ul.products:first li.product:visible').length;
                  wooCommerceCount = 'Showing ' + count + ' Results';
              }
              
              var selectedFilters = [];
              $('.wpfCheckbox input[type="checkbox"]:checked').each(function() {
                  var filterLabel = $(this).closest('.wpfCheckbox').parent().find('.wpfDisplay .wpfFilterTaxNameWrapper').text().trim();
                  if (filterLabel) {
                      selectedFilters.push(filterLabel);
                  }
              });
              
              // --- PRICE RANGE CHECK ---
              var $priceFilterWrapper = $('.wpfFilterWrapper');
              if ($priceFilterWrapper.length) {
                  
                  // 1. GET DEFAULT (STATIC) LIMITS from the input attributes
                  var $staticMinInput = $priceFilterWrapper.find('#wpfMinPrice'); 
                  var $staticMaxInput = $priceFilterWrapper.find('#wpfMaxPrice');
                  
                  var defaultMin = $staticMinInput.length ? parseInt($staticMinInput.attr('min')) : 0;
                  var defaultMax = $staticMaxInput.length ? parseInt($staticMaxInput.attr('max')) : 0;
                  
                  // 2. GET CURRENT (BUFFERED) VALUES from the visible divs
                  var $bufferMin = $priceFilterWrapper.find('.wpfVisibleBufferMin');
                  var $bufferMax = $priceFilterWrapper.find('.wpfVisibleBufferMax');
                  
                  // --- CURRENT MIN FIX (Slicing logic) ---
                  var rawMinText = $bufferMin.length ? $bufferMin.text() : String(defaultMin);
                  var cleanMinString = rawMinText.replace(/\D/g, ''); 
                  var currentMin;

                  if (cleanMinString.length > 0) {
                      if (cleanMinString.length % 2 === 0 && cleanMinString.length > 1) {
                          currentMin = parseInt(cleanMinString.substring(0, cleanMinString.length / 2));
                      } else {
                          currentMin = parseInt(cleanMinString);
                      }
                  } else {
                      currentMin = defaultMin;
                  }

                  // --- CURRENT MAX FIX (Slicing logic) ---
                  var rawMaxText = $bufferMax.length ? $bufferMax.text() : String(defaultMax);
                  var cleanMaxString = rawMaxText.replace(/\D/g, ''); 
                  var currentMax;

                  if (cleanMaxString.length > 0) {
                      if (cleanMaxString.length % 2 === 0 && cleanMaxString.length > 1) {
                          currentMax = parseInt(cleanMaxString.substring(0, cleanMaxString.length / 2));
                      } else {
                          currentMax = parseInt(cleanMaxString);
                      }
                  } else {
                      currentMax = defaultMax;
                  }

                  currentMin = parseInt(currentMin);
                  currentMax = parseInt(currentMax);

                  defaultMin = parseInt(defaultMin);
                  defaultMax = parseInt(defaultMax);
                  
                  // New formatted with a comma
                  if (currentMin !== defaultMin || currentMax !== defaultMax) {
                      
                      // --- NEW: Format numbers with thousands separators ---
                      var formattedMin = currentMin.toLocaleString('en-US'); 
                      var formattedMax = currentMax.toLocaleString('en-US');
                      // ----------------------------------------------------
                      
                      // Use the formatted variables in the label
                      var priceLabel = 'Price: $' + formattedMin + ' - $' + formattedMax;
                      selectedFilters.push(priceLabel);
                      // ... (rest of the logic)
                  }
              }
              
              var html = '<p>' + wooCommerceCount + '</p>';
              
              if (selectedFilters.length > 0) {
                  var wrappedFilters = selectedFilters.map(function(filterName) {
                      return '<span>' + filterName + '</span>';
                  });

                  html += '<p class="custom-result-count-active-filter"><strong>Filters Applied:</strong> ' + wrappedFilters.join(' ') + '</p>';
              }
              
              $('.custom-result-count').html(html);
          }, 500);
      }
      
      // --- 2. FUNCTION TO UPDATE BUTTON STATES (Active/Inactive) ---
      function updateFilterButtonStates() {
          var hasActiveFilters = $('.wpfCheckbox input[type="checkbox"]:checked').length > 0;
          var priceRangeActive = false;
          var $priceFilterWrapper = $('.wpfFilterWrapper');

          if ($priceFilterWrapper.length) {
              
              // 1. GET DEFAULT (STATIC) LIMITS
              var $staticMinInput = $priceFilterWrapper.find('#wpfMinPrice'); 
              var $staticMaxInput = $priceFilterWrapper.find('#wpfMaxPrice');

              var defaultMin = $staticMinInput.length ? parseInt($staticMinInput.attr('min')) : 0;
              var defaultMax = $staticMaxInput.length ? parseInt($staticMaxInput.attr('max')) : 0;
              
              // 2. GET CURRENT (BUFFERED) VALUES
              var $bufferMin = $priceFilterWrapper.find('.wpfVisibleBufferMin');
              var $bufferMax = $priceFilterWrapper.find('.wpfVisibleBufferMax');
              
              // --- CURRENT MIN FIX (Slicing logic) ---
              var rawMinText = $bufferMin.length ? $bufferMin.text() : String(defaultMin);
              var cleanMinString = rawMinText.replace(/\D/g, ''); 
              var currentMin;

              if (cleanMinString.length > 0) {
                  if (cleanMinString.length % 2 === 0 && cleanMinString.length > 1) {
                      currentMin = parseInt(cleanMinString.substring(0, cleanMinString.length / 2));
                  } else {
                      currentMin = parseInt(cleanMinString);
                  }
              } else {
                  currentMin = defaultMin;
              }

              // --- CURRENT MAX FIX (Slicing logic) ---
              var rawMaxText = $bufferMax.length ? $bufferMax.text() : String(defaultMax);
              var cleanMaxString = rawMaxText.replace(/\D/g, ''); 
              var currentMax;

              if (cleanMaxString.length > 0) {
                  if (cleanMaxString.length % 2 === 0 && cleanMaxString.length > 1) {
                      currentMax = parseInt(cleanMaxString.substring(0, cleanMaxString.length / 2));
                  } else {
                      currentMax = parseInt(cleanMaxString);
                  }
              } else {
                  currentMax = defaultMax;
              }

              currentMin = parseInt(currentMin);
              currentMax = parseInt(currentMax);

              defaultMin = parseInt(defaultMin);
              defaultMax = parseInt(defaultMax);
              
              // Check if current range differs from default range
              if (currentMin !== defaultMin || currentMax !== defaultMax) {
                  priceRangeActive = true;
              }
          }
          
          hasActiveFilters = hasActiveFilters || priceRangeActive;
          
          // Call the dedicated function to apply/remove classes
          applyButtonClasses(hasActiveFilters);
          
          console.log('(Desktop) Filter buttons updated. Active filters:', hasActiveFilters); // For debugging
      }

      // --- 3. EVENT LISTENERS ---
      
      // Initial call on page load
      updateCount(); 
      updateFilterButtonStates();

      // Listeners for general AJAX completion/filter updates
      $(document).on('berocket_ajax_products_loaded berocket_ajax_filtering_end', updateCount);
      $(document).ajaxComplete(updateCount);

      // Update when Filter or Clear buttons are clicked
      $(document).on('click', '.wpfFilterButton, .wpfClearButton, button[type="submit"]', function() {
          // A small delay to ensure the click action registers
          setTimeout(updateFilterButtonStates, 500);
      });
      
      // Listeners for the price range input change
      $(document).on('change', '#wpfMinPrice, #wpfMaxPrice', function() {
        // This event fires when the input value is changed (i.e., by the slider release)
        setTimeout(function() {
            updateCount();
            updateFilterButtonStates();
        }, 500); 
      });
      
      // --- RACE CONDITION FIX ---
      $(document).ajaxComplete(function() {
          setTimeout(updateFilterButtonStates, 1500); 
      });

      // --- SPECIFIC CLEAR BUTTON HANDLER --- ADD HERE
      $(document).on('click', '.wpfClearButton', function() {
          console.log('(Desktop) Clear button clicked');
          applyButtonClasses(false);
          setTimeout(function() {
              updateFilterButtonStates();
              updateCount();
          }, 2000);
      });

    }
  });
</script>
<!-- /////////////// STILL WORKING ON THIS /////////////// -->



<!-- MOBILE -->


<!-- Mobile Placeholder Title -->
<div class="custom-result-count-mobile">
</div>

<!-- Mobile Products Div Scripts (No Pagination) -->
<script>
  jQuery(document).ready(function($) {
    if ($(window).width() <= 980) {

      function updateCountMobile() {
        setTimeout(function() {
          // Count only in the FIRST products container (desktop)
          var count = $('ul.products:last li.product:visible').length;
          
          // Get selected filter names
          var selectedFilters = [];
          $('.mobile-filter-area .wpfCheckbox input[type="checkbox"]:checked').each(function() {
              // Go up one level and find next .wpfDisplay
              var filterLabel = $(this).closest('.wpfCheckbox').parent().find('.wpfDisplay .wpfFilterTaxNameWrapper').text().trim();
              
              if (filterLabel) {
                  selectedFilters.push(filterLabel);
              }
          });
          
          // Build the HTML
          var html = '<p>Showing ' + count + ' Results</p>';
          
          if (selectedFilters.length > 0) {
            // Map each filter name to a new array where it's wrapped in <span> tags
            var wrappedFilters = selectedFilters.map(function(filterName) {
                return '<span>' + filterName + '</span>';
            });

            // Join the wrapped filters with a simple separator (like a comma and space)
            html += '<p class="custom-result-count-active-filter-mobile"><strong>Filters Applied:</strong> ' + wrappedFilters.join(' ') + '</p>';
          }
          
          $('.custom-result-count-mobile').html(html);
          console.log('Mobile count:', count);
        }, 500);
      }
      
      // ADD THESE LINES BACK:
      $(document).on('berocket_ajax_products_loaded berocket_ajax_filtering_end', updateCountMobile);
      $(document).ajaxComplete(updateCountMobile);
      updateCountMobile(); // Call on initial page load

      // Filter and Clear Buttons styles
      function updateFilterButtonStatesMobile() {
        var hasActiveFilters = $('.wpfCheckbox input[type="checkbox"]:checked').length > 0;
        
        var $filterButton = $('.wpfFilterButton, button[type="submit"]').filter(function() {
            return $(this).text().toLowerCase().includes('filter');
        });
        
        var $clearButton = $('.wpfClearButton');
        var $resultCount = $('.custom-result-count-mobile');
        
        if (hasActiveFilters) {
            // Filters are active
            $filterButton.addClass('has-active-filters').removeClass('no-active-filters');
            $clearButton.addClass('has-active-filters').removeClass('no-active-filters');
            $resultCount.addClass('has-active-filters').removeClass('no-active-filters');
        } else {
            // No filters active
            $filterButton.addClass('no-active-filters').removeClass('has-active-filters');
            $clearButton.addClass('no-active-filters').removeClass('has-active-filters');
            $resultCount.addClass('no-active-filters').removeClass('has-active-filters');
        }
        
        console.log('Filter buttons updated. Active filters:', hasActiveFilters);
      }

      // Update when Filter or Clear buttons are clicked
      $(document).on('click', '.wpfFilterButton, .wpfClearButton, button[type="submit"]', function() {
          setTimeout(updateFilterButtonStatesMobile, 500);
      });

      // Update after AJAX completes
      $(document).on('berocket_ajax_products_loaded berocket_ajax_filtering_end', function() {
          setTimeout(updateFilterButtonStatesMobile, 300);
      });

      // Update on AJAX completion
      $(document).ajaxComplete(function() {
          setTimeout(updateFilterButtonStatesMobile, 500);
      });

      // Initial state
      updateFilterButtonStatesMobile();

    }
  });
</script>

<!-- Add Class to code block holding the filter shortcode - on the left -->
mobile-filter-area

<!-- Shortcode for Products Display on Desktop -->
[products category="specialty-colors" limit="-1" per_page="-1" columns="4"]



<!-- /////////////// STILL WORKING ON THIS /////////////// -->
<!-- Mobile Products Div Scripts (Pagination) -->
<script>
  jQuery(document).ready(function($) {
    if ($(window).width() <= 980) {

      // Function to apply/remove active classes based on the filter status
      function applyButtonClassesMobile(hasActiveFilters) {
          // Use the most specific selector possible to win the CSS race
          var $clearButton = $('.wpfFilterButtons .wpfClearButton');
          var $filterButton = $('.wpfFilterButtons .wpfFilterButton');
          var $resultCount = $('.custom-result-count-mobile');
          var $sliderRange = $('.wpfPriceFilterRange');

          if (hasActiveFilters) {
              // ADD the active class and immediately remove the inactive one
              $clearButton.addClass('has-active-filters').removeClass('no-active-filters');
              $filterButton.addClass('has-active-filters').removeClass('no-active-filters');
              $resultCount.addClass('has-active-filters').removeClass('no-active-filters');
              $sliderRange.addClass('has-active-filters').removeClass('no-active-filters');
              console.log('(Mobile) Class Applied Has Active Filters'); // Use for testing confirmation
          } else {
              // REMOVE the active class and immediately add the inactive one
              $clearButton.removeClass('has-active-filters').addClass('no-active-filters');
              $filterButton.removeClass('has-active-filters').addClass('no-active-filters');
              $resultCount.removeClass('has-active-filters').addClass('no-active-filters');
              $sliderRange.removeClass('has-active-filters').addClass('no-active-filters');
              console.log('(Mobile) Class Applied No Active Filters'); // Use for testing confirmation
          }
      }

      // --- 1. FUNCTION TO UPDATE COUNT AND ACTIVE FILTERS ---
      function updateCountMobile() {
          // Use a short delay to ensure AJAX is complete and values are updated
          setTimeout(function() {
              var wooCommerceCount = $('.woocommerce-result-count').first().text().trim();
              
              if (!wooCommerceCount) {
                  var count = $('ul.products:last li.product:visible').length;
                  wooCommerceCount = 'Showing ' + count + ' Results';
              }
              
              var selectedFilters = [];
              $('.wpfCheckbox input[type="checkbox"]:checked').each(function() {
                  var filterLabel = $(this).closest('.wpfCheckbox').parent().find('.wpfDisplay .wpfFilterTaxNameWrapper').text().trim();
                  if (filterLabel) {
                      selectedFilters.push(filterLabel);
                  }
              });
              
              // --- PRICE RANGE CHECK ---
              var $priceFilterWrapper = $('.wpfFilterWrapper');
              if ($priceFilterWrapper.length) {
                  
                  // 1. GET DEFAULT (STATIC) LIMITS from the input attributes
                  var $staticMinInput = $priceFilterWrapper.find('#wpfMinPrice'); 
                  var $staticMaxInput = $priceFilterWrapper.find('#wpfMaxPrice');
                  
                  var defaultMin = $staticMinInput.length ? parseInt($staticMinInput.attr('min')) : 0;
                  var defaultMax = $staticMaxInput.length ? parseInt($staticMaxInput.attr('max')) : 0;
                  
                  // 2. GET CURRENT (BUFFERED) VALUES from the visible divs
                  var $bufferMin = $priceFilterWrapper.find('.wpfVisibleBufferMin');
                  var $bufferMax = $priceFilterWrapper.find('.wpfVisibleBufferMax');
                  
                  // --- CURRENT MIN FIX (Slicing logic) ---
                  var rawMinText = $bufferMin.length ? $bufferMin.text() : String(defaultMin);
                  var cleanMinString = rawMinText.replace(/\D/g, ''); 
                  var currentMin;

                  if (cleanMinString.length > 0) {
                      if (cleanMinString.length % 2 === 0 && cleanMinString.length > 1) {
                          currentMin = parseInt(cleanMinString.substring(0, cleanMinString.length / 2));
                      } else {
                          currentMin = parseInt(cleanMinString);
                      }
                  } else {
                      currentMin = defaultMin;
                  }

                  // --- CURRENT MAX FIX (Slicing logic) ---
                  var rawMaxText = $bufferMax.length ? $bufferMax.text() : String(defaultMax);
                  var cleanMaxString = rawMaxText.replace(/\D/g, ''); 
                  var currentMax;

                  if (cleanMaxString.length > 0) {
                      if (cleanMaxString.length % 2 === 0 && cleanMaxString.length > 1) {
                          currentMax = parseInt(cleanMaxString.substring(0, cleanMaxString.length / 2));
                      } else {
                          currentMax = parseInt(cleanMaxString);
                      }
                  } else {
                      currentMax = defaultMax;
                  }

                  currentMin = parseInt(currentMin);
                  currentMax = parseInt(currentMax);

                  defaultMin = parseInt(defaultMin);
                  defaultMax = parseInt(defaultMax);
                  
                  // New formatted with a comma
                  if (currentMin !== defaultMin || currentMax !== defaultMax) {
                      
                      // --- NEW: Format numbers with thousands separators ---
                      var formattedMin = currentMin.toLocaleString('en-US'); 
                      var formattedMax = currentMax.toLocaleString('en-US');
                      // ----------------------------------------------------
                      
                      // Use the formatted variables in the label
                      var priceLabel = 'Price: $' + formattedMin + ' - $' + formattedMax;
                      selectedFilters.push(priceLabel);
                      // ... (rest of the logic)
                  }
              }
              
              var html = '<p>' + wooCommerceCount + '</p>';
              
              if (selectedFilters.length > 0) {
                  var wrappedFilters = selectedFilters.map(function(filterName) {
                      return '<span>' + filterName + '</span>';
                  });

                  html += '<p class="custom-result-count-active-filter-mobile"><strong>Filters Applied:</strong> ' + wrappedFilters.join(' ') + '</p>';
              }
              
              $('.custom-result-count-mobile').html(html);
          }, 500);
      }
      
      // --- 2. FUNCTION TO UPDATE BUTTON STATES (Active/Inactive) ---
      function updateFilterButtonStatesMobile() {
        var hasActiveFilters = $('.wpfCheckbox input[type="checkbox"]:checked').length > 0;
        var priceRangeActive = false;
        var $priceFilterWrapper = $('.wpfFilterWrapper');

        if ($priceFilterWrapper.length) {
            
            // 1. GET DEFAULT (STATIC) LIMITS
            var $staticMinInput = $priceFilterWrapper.find('#wpfMinPrice'); 
            var $staticMaxInput = $priceFilterWrapper.find('#wpfMaxPrice');

            var defaultMin = $staticMinInput.length ? parseInt($staticMinInput.attr('min')) : 0;
            var defaultMax = $staticMaxInput.length ? parseInt($staticMaxInput.attr('max')) : 0;
            
            // 2. GET CURRENT (BUFFERED) VALUES
            var $bufferMin = $priceFilterWrapper.find('.wpfVisibleBufferMin');
            var $bufferMax = $priceFilterWrapper.find('.wpfVisibleBufferMax');
            
            // --- CURRENT MIN FIX (Slicing logic) ---
            var rawMinText = $bufferMin.length ? $bufferMin.text() : String(defaultMin);
            var cleanMinString = rawMinText.replace(/\D/g, ''); 
            var currentMin;

            if (cleanMinString.length > 0) {
                if (cleanMinString.length % 2 === 0 && cleanMinString.length > 1) {
                    currentMin = parseInt(cleanMinString.substring(0, cleanMinString.length / 2));
                } else {
                    currentMin = parseInt(cleanMinString);
                }
            } else {
                currentMin = defaultMin;
            }

            // --- CURRENT MAX FIX (Slicing logic) ---
            var rawMaxText = $bufferMax.length ? $bufferMax.text() : String(defaultMax);
            var cleanMaxString = rawMaxText.replace(/\D/g, ''); 
            var currentMax;

            if (cleanMaxString.length > 0) {
                if (cleanMaxString.length % 2 === 0 && cleanMaxString.length > 1) {
                    currentMax = parseInt(cleanMaxString.substring(0, cleanMaxString.length / 2));
                } else {
                    currentMax = parseInt(cleanMaxString);
                }
            } else {
                currentMax = defaultMax;
            }

            currentMin = parseInt(currentMin);
            currentMax = parseInt(currentMax);

            defaultMin = parseInt(defaultMin);
            defaultMax = parseInt(defaultMax);
            
            // Check if current range differs from default range
            if (currentMin !== defaultMin || currentMax !== defaultMax) {
                priceRangeActive = true;
            }
          }
          
          hasActiveFilters = hasActiveFilters || priceRangeActive;
          
          // Call the dedicated function to apply/remove classes
          applyButtonClassesMobile(hasActiveFilters);
          
          console.log('(Mobile) Filter buttons updated. Active filters:', hasActiveFilters); // For debugging
      }

      // --- 3. EVENT LISTENERS ---
      
      // Initial call on page load
      updateCountMobile(); 
      updateFilterButtonStatesMobile();

      // Listeners for general AJAX completion/filter updates
      $(document).on('berocket_ajax_products_loaded berocket_ajax_filtering_end', updateCountMobile);
      $(document).ajaxComplete(updateCountMobile);

      // Update when Filter or Clear buttons are clicked
      $(document).on('click', '.wpfFilterButton, .wpfClearButton, button[type="submit"]', function() {
          // A small delay to ensure the click action registers
          setTimeout(updateFilterButtonStatesMobile, 500);
      });
      
      // Listeners for the price range input change
      $(document).on('change', '#wpfMinPrice, #wpfMaxPrice', function() {
          // This event fires when the input value is changed (i.e., by the slider release)
          setTimeout(function() {
              updateCountMobile();
              updateFilterButtonStatesMobile();
          }, 500); 
      });
      
      // --- RACE CONDITION FIX ---
      $(document).ajaxComplete(function() {
          setTimeout(updateFilterButtonStatesMobile, 1500); 
      });

      // --- SPECIFIC CLEAR BUTTON HANDLER --- ADD HERE
      $(document).on('click', '.wpfClearButton', function() {
          console.log('(Mobile) Clear button clicked');
          applyButtonClassesMobile(false);
          setTimeout(function() {
              updateFilterButtonStatesMobile();
              updateCountMobile();
          }, 3000);
      });

    }
  });
</script>
<!-- /////////////// STILL WORKING ON THIS /////////////// -->




